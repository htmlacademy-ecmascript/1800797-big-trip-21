(()=>{"use strict";var e={10:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(537),s=n.n(i),o=n(645),r=n.n(o)()(s());r.push([e.id,".shake {\n  animation: shake 0.6s;\n  position: relative;\n  z-index: 10;\n}\n\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-5px);\n  }\n\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(5px);\n  }\n}\n","",{version:3,sources:["webpack://./src/framework/view/abstract-view.css"],names:[],mappings:"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,WAAW;AACb;;AAEA;EACE;;IAEE,wBAAwB;EAC1B;;EAEA;;;;;IAKE,2BAA2B;EAC7B;;EAEA;;;;IAIE,0BAA0B;EAC5B;AACF",sourcesContent:[".shake {\n  animation: shake 0.6s;\n  position: relative;\n  z-index: 10;\n}\n\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-5px);\n  }\n\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(5px);\n  }\n}\n"],sourceRoot:""}]);const a=r},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,s,o){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var d=0;d<e.length;d++){var p=[].concat(e[d]);i&&r[p[0]]||(void 0!==o&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=o),n&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=n):p[2]=n),s&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=s):p[4]="".concat(s)),t.push(p))}},t}},537:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(s," */");return[t].concat([o]).join("\n")}return[t].join("\n")}},379:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},r=[],a=0;a<e.length;a++){var l=e[a],d=i.base?l[0]+i.base:l[0],p=o[d]||0,c="".concat(d," ").concat(p);o[d]=p+1;var h=n(c),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(u);else{var v=s(u,i);i.byIndex=a,t.splice(a,0,{identifier:c,updater:v,references:1})}r.push(c)}return r}function s(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var o=i(e=e||[],s=s||{});return function(e){e=e||[];for(var r=0;r<o.length;r++){var a=n(o[r]);t[a].references--}for(var l=i(e,s),d=0;d<o.length;d++){var p=n(o[d]);0===t[p].references&&(t[p].updater(),t.splice(p,1))}o=l}}},569:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,s&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={id:i,exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,(()=>{var e=n(379),t=n.n(e),i=n(795),s=n.n(i),o=n(569),r=n.n(o),a=n(565),l=n.n(a),d=n(216),p=n.n(d),c=n(589),h=n.n(c),u=n(10),v={};v.styleTagTransform=h(),v.setAttributes=l(),v.insert=r().bind(null,"head"),v.domAPI=s(),v.insertStyleElement=p(),t()(u.Z,v),u.Z&&u.Z.locals&&u.Z.locals;const f="shake";class _{#e=null;constructor(){if(new.target===_)throw new Error("Can't instantiate AbstractView, only concrete one.")}get element(){return this.#e||(this.#e=function(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}(this.template)),this.#e}get template(){throw new Error("Abstract method not implemented: get template")}removeElement(){this.#e=null}shake(e){this.element.classList.add(f),setTimeout((()=>{this.element.classList.remove(f),e?.()}),600)}}function m(e,t,n="beforeend"){if(!(e instanceof _))throw new Error("Can render only components");if(null===t)throw new Error("Container element doesn't exist");t.insertAdjacentElement(n,e.element)}function y(e,t){if(!(e instanceof _&&t instanceof _))throw new Error("Can replace only components");const n=e.element,i=t.element,s=i.parentElement;if(null===s)throw new Error("Parent element doesn't exist");s.replaceChild(n,i)}function b(e){if(null!==e){if(!(e instanceof _))throw new Error("Can remove only components");e.element.remove(),e.removeElement()}}class g extends _{get template(){return'<section class="trip-main__trip-info  trip-info">\n  <div class="trip-info__main">\n    <h1 class="trip-info__title">Amsterdam &mdash; Chamonix &mdash; Geneva</h1>\n\n    <p class="trip-info__dates">Mar 18&nbsp;&mdash;&nbsp;20</p>\n  </div>\n\n  <p class="trip-info__cost">\n    Total: &euro;&nbsp;<span class="trip-info__cost-value">1230</span>\n  </p>\n  </section>'}}class w extends _{get template(){return'<form class="trip-filters" action="#" method="get">\n  <div class="trip-filters__filter">\n    <input id="filter-everything" class="trip-filters__filter-input  visually-hidden" type="radio" name="trip-filter" value="everything" checked>\n    <label class="trip-filters__filter-label" for="filter-everything">Everything</label>\n  </div>\n\n  <div class="trip-filters__filter">\n    <input id="filter-future" class="trip-filters__filter-input  visually-hidden" type="radio" name="trip-filter" value="future">\n    <label class="trip-filters__filter-label" for="filter-future">Future</label>\n  </div>\n\n  <div class="trip-filters__filter">\n    <input id="filter-present" class="trip-filters__filter-input  visually-hidden" type="radio" name="trip-filter" value="present">\n    <label class="trip-filters__filter-label" for="filter-present">Present</label>\n  </div>\n\n  <div class="trip-filters__filter">\n    <input id="filter-past" class="trip-filters__filter-input  visually-hidden" type="radio" name="trip-filter" value="past">\n    <label class="trip-filters__filter-label" for="filter-past">Past</label>\n  </div>\n\n  <button class="visually-hidden" type="submit">Accept filter</button>\n  </form>'}}class C extends _{constructor({onSortTypeChange:e}){super(),this.onSortTypeChange=e,this.element.addEventListener("change",this.#t)}get template(){return'\n  <form class="trip-events__trip-sort  trip-sort" action="#" method="get">\n            <div class="trip-sort__item  trip-sort__item--day">\n              <input id="sort-day" class="trip-sort__input  visually-hidden" type="radio" name="trip-sort" value="sort-day" checked>\n              <label class="trip-sort__btn" for="sort-day">Day</label>\n            </div>\n\n            <div class="trip-sort__item  trip-sort__item--event">\n              <input id="sort-event" class="trip-sort__input  visually-hidden" type="radio" name="trip-sort" value="sort-event">\n              <label class="trip-sort__btn" for="sort-event">Event</label>\n            </div>\n\n            <div class="trip-sort__item  trip-sort__item--time">\n              <input id="sort-time" class="trip-sort__input  visually-hidden" type="radio" name="trip-sort" value="sort-time">\n              <label class="trip-sort__btn" for="sort-time">Time</label>\n            </div>\n\n            <div class="trip-sort__item  trip-sort__item--price">\n              <input id="sort-price" class="trip-sort__input  visually-hidden" type="radio" name="trip-sort" value="sort-price">\n              <label class="trip-sort__btn" for="sort-price">Price</label>\n            </div>\n\n            <div class="trip-sort__item  trip-sort__item--offer">\n              <input id="sort-offer" class="trip-sort__input  visually-hidden" type="radio" name="trip-sort" value="sort-offer">\n              <label class="trip-sort__btn" for="sort-offer">Offers</label>\n            </div>\n          </form>'}#t=e=>{this.onSortTypeChange(e.target.value)};removeElement(){this.element=null}}class E extends _{get template(){return'<ul class="trip-events__list"></ul>'}}class M extends _{constructor({title:e,price:t}){super(),this.offerTitle=e,this.offerPrice=t}get template(){return`\n  <li class="event__offer">\n  <span class="event__offer-title">${this.offerTitle}</span>\n  &plus;&euro;&nbsp;\n  <span class="event__offer-price">${this.offerPrice}</span>\n  </li>\n  `}}class P extends _{constructor({event:e,dest:t,offer:n,openEditForm:i,onSetFavourite:s}){super(),this.event=e,this.dest=t,this.offer=n,this.openEditForm=i,this.onSetFavourite=s,this.element.querySelector(".event__rollup-btn").addEventListener("click",this.#n),this.element.querySelector(".event__favorite-btn").addEventListener("click",this.#i)}get template(){return e=this.event,t=this.dest,n=this.offer,`\n  <li class="trip-events__item">\n  <div class="event">\n    <time class="event__date" datetime="2019-03-18">${e.date_from}</time>\n    <div class="event__type">\n      <img class="event__type-icon" width="42" height="42" src="img/icons/${e.type}.png" alt="Event type icon">\n    </div>\n    <h3 class="event__title">${e.type} ${t.getById(e.destination).name}</h3>\n    <div class="event__schedule">\n      <p class="event__time">\n        <time class="event__start-time" datetime="2019-03-18T10:30">10:30</time>\n        &mdash;\n        <time class="event__end-time" datetime="2019-03-18T11:00">11:00</time>\n      </p>\n      <p class="event__duration">30M</p>\n    </div>\n    <p class="event__price">\n      &euro;&nbsp;<span class="event__price-value">${e.base_price}</span>\n    </p>\n    <h4 class="visually-hidden">Offers:</h4>\n    <ul class="event__selected-offers">\n      ${e.offers.length?e.offers.map((t=>new M(n.getById(e.type,t)).template)).join(""):""}\n    </ul >\n    <button class="event__favorite-btn ${e.is_favorite?"event__favorite-btn--active":""}" type="button">\n      <span class="visually-hidden">Add to favorite</span>\n      <svg class="event__favorite-icon" width="28" height="28" viewBox="0 0 28 28">\n        <path d="M14 21l-8.22899 4.3262 1.57159-9.1631L.685209 9.67376 9.8855 8.33688 14 0l4.1145 8.33688 9.2003 1.33688-6.6574 6.48934 1.5716 9.1631L14 21z"/>\n      </svg>\n    </button>\n    <button class="event__rollup-btn" type="button">\n      <span class="visually-hidden">Open event</span>\n    </button>\n  </div >\n</li > `;var e,t,n}#n=e=>{e.preventDefault(),this.openEditForm(),console.log("openEdit")};#i=e=>{e.preventDefault(),this.onSetFavourite(),console.log("SetFavouriteFromPointView")}}class A extends _{constructor(e,t,n){super(),this.offer=e,this.index=t,this.pointOffers=n}get template(){return e=this.offer,`\n  <div class="event__offer-selector">\n    <input\n      class="event__offer-checkbox  visually-hidden"\n      id="event-offer-luggage-${t=this.index}"\n      type="checkbox"\n      name="event-offer-luggage"\n      ${this.pointOffers.includes(e.id)?"checked":""}\n      data-id = ${e.id}\n      >\n    <label class="event__offer-label" for="event-offer-luggage-${t}">\n      <span class="event__offer-title">${e.title}</span>\n      &plus;&euro;&nbsp;\n      <span class="event__offer-price">${e.price}</span>\n  </label>\n  </div>\n  `;var e,t}}class S extends _{_state={};updateElement(e){e&&(this._setState(e),this.#s())}_restoreHandlers(){throw new Error("Abstract method not implemented: restoreHandlers")}_setState(e){this._state=structuredClone({...this._state,...e})}#s(){const e=this.element,t=e.parentElement;this.removeElement();const n=this.element;t.replaceChild(n,e),this._restoreHandlers()}}class T extends S{#o;#r;#a=null;constructor({point:e,destinations:t,offers:n,closeEditForm:i,updatePoint:s,newPoint:o=!1,deletePoint:r}){super(),this.offers=n,this.destinations=t,this.closeEditForm=i,this._setState(T.parsePointToState(e)),this.#o=s,this.#a=o,this.#r=r,this._restoreHandlers()}_restoreHandlers(){this.element.addEventListener("submit",this.#l),this.element.querySelector(".event__type-group").addEventListener("change",this.#d),this.element.querySelector(".event__input").addEventListener("change",this.#p),this.element.querySelector(".event__input--price").addEventListener("input",this.#c),this.element.querySelector(".event__available-offers").addEventListener("change",this.#h),this.element.querySelector(".event-reset").addEventListener("click",this.#u),this.element.querySelector(".event-delete")&&this.element.querySelector(".event-delete").addEventListener("click",this.#v)}#h=e=>{console.log(e.target.dataset.id);const t=Array.from(document.querySelectorAll(".event__offer-checkbox")).filter((e=>e.checked)).map((e=>e.dataset.id));console.log(t),this._setState({point:{...this._state.point,offers:[...t]}})};#c=e=>{this._setState({point:{...this._state.point,base_price:e.target.value}})};#d=e=>{this.updateElement({point:{...this._state.point,type:e.target.value,offers:[]}})};#p=e=>{console.log(e.target.value),this.updateElement({point:{...this._state.point,destination:this.destinations.getByName(e.target.value).id}})};get template(){return function({state:e,destinations:t,offers:n,newPointMode:i}){return`\n  <form class="event event--edit" action="#" method="post">\n                <header class="event__header">\n                  <div class="event__type-wrapper">\n                    <label class="event__type  event__type-btn" for="event-type-toggle-1">\n                      <span class="visually-hidden">Choose event type</span>\n                      ${e.point.type?`\n                      <img\n                      class="event__type-icon"\n                      width="17"\n                      height="17"\n                      src="img/icons/${e.point.type}.png"\n                      alt="Event type icon"\n                      >\n                      `:""}\n\n                    </label>\n                    <input class="event__type-toggle  visually-hidden" id="event-type-toggle-1" type="checkbox">\n\n                    <div class="event__type-list">\n                      <fieldset class="event__type-group">\n                        <legend class="visually-hidden">Event type</legend>\n\n                        <div class="event__type-item">\n                          <input id="event-type-taxi-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="taxi">\n                          <label class="event__type-label  event__type-label--taxi" for="event-type-taxi-1">Taxi</label>\n                        </div>\n\n                        <div class="event__type-item">\n                          <input id="event-type-bus-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="bus">\n                          <label class="event__type-label  event__type-label--bus" for="event-type-bus-1">Bus</label>\n                        </div>\n\n                        <div class="event__type-item">\n                          <input id="event-type-train-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="train">\n                          <label class="event__type-label  event__type-label--train" for="event-type-train-1">Train</label>\n                        </div>\n\n                        <div class="event__type-item">\n                          <input id="event-type-ship-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="ship">\n                          <label class="event__type-label  event__type-label--ship" for="event-type-ship-1">Ship</label>\n                        </div>\n\n                        <div class="event__type-item">\n                          <input id="event-type-drive-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="drive">\n                          <label class="event__type-label  event__type-label--drive" for="event-type-drive-1">Drive</label>\n                        </div>\n\n                        <div class="event__type-item">\n                          <input id="event-type-flight-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="flight" checked>\n                          <label class="event__type-label  event__type-label--flight" for="event-type-flight-1">Flight</label>\n                        </div>\n\n                        <div class="event__type-item">\n                          <input id="event-type-check-in-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="check-in">\n                          <label class="event__type-label  event__type-label--check-in" for="event-type-check-in-1">Check-in</label>\n                        </div>\n\n                        <div class="event__type-item">\n                          <input id="event-type-sightseeing-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="sightseeing">\n                          <label class="event__type-label  event__type-label--sightseeing" for="event-type-sightseeing-1">Sightseeing</label>\n                        </div>\n\n                        <div class="event__type-item">\n                          <input id="event-type-restaurant-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="restaurant">\n                          <label class="event__type-label  event__type-label--restaurant" for="event-type-restaurant-1">Restaurant</label>\n                        </div>\n                      </fieldset>\n                    </div>\n                  </div>\n\n                  <div class="event__field-group  event__field-group--destination">\n                    <label class="event__label  event__type-output" for="event-destination-1">\n                      ${e.point.type?e.point.type:""}\n                    </label>\n                    <input\n                    class="event__input  event__input--destination"\n                    id="event-destination-1"\n                    type="text"\n                    name="event-destination"\n                    value="${e.point.destination?t.getById(e.point.destination).name:""}"\n                    list="destination-list-1"\n                    >\n                    <datalist id="destination-list-1">\n                    ${t.get().map((e=>`<option value="${e.name}"></option>`)).join("")}\n\n                    </datalist>\n                  </div>\n\n                  <div class="event__field-group  event__field-group--time">\n                    <label class="visually-hidden" for="event-start-time-1">From</label>\n                    <input class="event__input  event__input--time" id="event-start-time-1" type="text" name="event-start-time" value="19/03/19 00:00">\n                    &mdash;\n                    <label class="visually-hidden" for="event-end-time-1">To</label>\n                    <input class="event__input  event__input--time" id="event-end-time-1" type="text" name="event-end-time" value="19/03/19 00:00">\n                  </div>\n\n                  <div class="event__field-group  event__field-group--price">\n                    <label class="event__label" for="event-price-1">\n                      <span class="visually-hidden">Price</span>\n                      &euro;\n                    </label>\n                    <input\n                    class="event__input  event__input--price"\n                    id="event-price-1"\n                    type="text"\n                    name="event-price"\n                    value="${e.point.base_price}"\n                    >\n                  </div>\n\n                  <button class="event__save-btn  btn  btn--blue" type="submit">Save</button>\n                  <button class="event__reset-btn event-reset" type="reset">Cancel</button>\n                  ${i?"":'\n                  <button class="event__reset-btn event-delete" type="button">Delete</button>\n                  '}\n                </header>\n                <section class="event__details">\n                  <section class="event__section  event__section--offers">\n                    <h3 class="event__section-title  event__section-title--offers">Offers</h3>\n\n                    <div class="event__available-offers">\n                    ${e.point.offers?`${function(e,t){return console.log(t.get().find((t=>t.type===e)).offers),t.get().find((t=>t.type===e)).offers}(e.point.type,n).map(((t,n)=>new A(t,n,e.point.offers).template)).join("")}\n                        `:""}\n                    </div>\n                  </section>\n\n                  <section class="event__section  event__section--destination">\n                    <h3 class="event__section-title  event__section-title--destination">Destination</h3>\n                    <p class="event__destination-description">\n                    ${e.point.destination?t.getById(e.point.destination).description:""}\n                    </p>\n\n                    <div class="event__photos-container">\n                      <div class="event__photos-tape">\n                        ${e.point.destination?t.getById(e.point.destination).pictures.map((e=>`<img class="event__photo" src="${e.src}" alt="${e.description}">`)).join(""):""}\n                      </div>\n                    </div>\n                  </section>\n                </section>\n              </form>`}({state:this._state,destinations:this.destinations,offers:this.offers,newPointMode:this.#a})}static parsePointToState=e=>({point:e});static parseStateToPoint=e=>e.point;#l=e=>{e.preventDefault(),this.#o(this._state.point),this.closeEditForm()};#u=e=>{e.preventDefault(),this.closeEditForm()};#v=e=>{e.preventDefault(),this.#r(this._state.point),this.closeEditForm()}}const k="sort-event",x="sort-offer",H="UPDATE_POINT",F="ADD_POINT",I="DELETE_POINT",$={PATCH:"PATCH",MINOR:"MINOR",MAJOR:"MAJOR"},D="points",B="DEFAULT",N="EDITING";class O{#f=null;#_=null;#m=null;#y=null;#b=null;#g=null;#w=null;#C=B;#E=null;#M=null;constructor({list:e,dest:t,offer:n,setFavourite:i,onDataChange:s,onModeChange:o}){this.#_=t,this.#m=e,this.#y=n,this.#b=i,this.#E=s,this.#M=o}init(e){this.#f=e,this.#P(this.#f)}destroy(){b(this.#w),b(this.#g)}#P(e){const t=this.#w,n=this.#g;this.#w=new P({event:e,dest:this.#_,offer:this.#y,openEditForm:()=>{this.#A()},onSetFavourite:()=>{this.#S()}}),this.#g=new T({point:e,destinations:this.#_,offers:this.#y,closeEditForm:()=>{this.#T()},updatePoint:e=>{this.#k(e)},deletePoint:e=>{this.#x(e)}}),null!==t&&null!==n?(this.#C===B&&y(this.#w,t),this.#C===N&&y(this.#g,n),b(t),b(n)):m(this.#w,this.#m.element)}#k(e){this.#E(H,$.MINOR,e)}#x(e){this.#E(I,$.MINOR,e)}resetView(){this.#C!==B&&this.#T()}#S(){this.#b(this.#f)}#H=e=>{"Escape"===e.key&&(e.preventDefault(),this.#T())};#A(){y(this.#g,this.#w),document.addEventListener("keydown",this.#H),this.#M(),this.#C=N}#T(){y(this.#w,this.#g),document.removeEventListener("keydown",this.#H),this.#C=B}}class L extends S{#F=null;constructor({onClick:e}){super(),this.#F=e,this._setState(L.parseAddModeState(!1)),this._restoreHandlers()}static parseAddModeState=e=>({addingMode:e});static parseStateToPoint=e=>state.addingMode;_restoreHandlers(){this.element.addEventListener("click",this.#I)}#I=()=>{this.updateElement({addingMode:!this._state.addingMode}),this.#F()};get template(){return function({disabled:e}){return`\n  <button\n   class="trip-main__event-add-btn  btn  btn--big  btn--yellow"\n    type="button"\n    ${e?"disabled":""}\n    >New event</button>\n  `}({disabled:this._state.addingMode})}}const R={base_price:0,date_from:"2024-01-06T00:00:02.106Z",date_to:"2024-01-06T15:10:02.106Z",destination:null,is_favorite:!1,offers:null,type:null};class q{#$=null;#_=null;#y=null;#D=null;constructor({destinationModel:e,offerModel:t,onDataAdd:n}){this.#_=e,this.#y=t,this.#D=n}addNewPointButton=new L({onClick:()=>{this.#B()}});addNewButtonContainer=document.querySelector(".trip-main");init(){m(this.addNewPointButton,this.addNewButtonContainer,"beforeend")}#B(){console.log("addNewPoint"),this.#$=new T({point:R,destinations:this.#_,offers:this.#y,closeEditForm:()=>{this.#N()},updatePoint:e=>{this.#O(e)},newPoint:!0}),m(this.#$,document.querySelector(".trip-events__list"),"beforebegin")}#N=()=>{b(this.#$)};#O=e=>{this.#D(F,$.MINOR,e)}}class j{#L=new Set;addObserver(e){this.#L.add(e)}removeObserver(e){this.#L.delete(e)}_notify(e,t){this.#L.forEach((n=>n(e,t)))}}class U{constructor(e,t){this._endPoint=e,this._authorization=t}async _load({url:e,method:t="GET",body:n=null,headers:i=new Headers}){i.append("Authorization",this._authorization);const s=await fetch(`${this._endPoint}/${e}`,{method:t,body:n,headers:i});try{return U.checkStatus(s),s}catch(e){U.catchError(e)}}static parseResponse(e){return e.json()}static checkStatus(e){if(!e.ok)throw new Error(`${e.status}: ${e.statusText}`)}static catchError(e){throw e}}const V=new class extends U{getPoints(){return this._load({url:D}).then(U.parseResponse)}getDestinations(){return this._load({url:"destinations"}).then(U.parseResponse)}getOffers(){return this._load({url:"offers"}).then(U.parseResponse)}async updatePoint(e){const t=await this._load({url:`${D}/${e.id}`,method:"PUT",body:JSON.stringify(e),headers:new Headers({"Content-Type":"application/json"})});return await U.parseResponse(t)}async addPoint(e){const t=await this._load({url:`${D}`,method:"POST",body:JSON.stringify(e),headers:new Headers({"Content-Type":"application/json"})});return await U.parseResponse(t)}async deletePoint(e){const t=await this._load({url:`${D}/${e}`,method:"DELETE",headers:new Headers({"Content-Type":"application/json"})});return await U.parseResponse(t)}}("https://21.objects.pages.academy/big-trip","Basic hS22344rwegy5ey"),Z=new class extends j{#R=[];#q=null;constructor(e){super(),this.#q=e}async init(){try{const e=await this.#q.getDestinations();this.#R=e,console.log(" this.#destinationsModel  ",this.#R)}catch(e){this.#R=[]}this._notify($.INIT)}get(){return this.#R}getById(e){return this.#R.find((t=>t.id===e))}getByName(e){return this.#R.find((t=>t.name.toLowerCase()===e.toLowerCase()))}}(V),z=new class extends j{#j=[];#q=null;constructor(e){super(),this.#q=e}async init(){try{const e=await this.#q.getOffers();this.#j=e,console.log(" this.#offersModel  ",this.#j)}catch(e){this.#j=[]}this._notify($.INIT)}get(){return this.#j}getByType(e){return this.#j.find((t=>t.type===e)).offers}getById(e,t){return this.getByType(e).find((e=>e.id===t))}}(V),J=new class extends j{#U=[];#q=null;#R=null;#j=null;constructor({service:e,destinationModel:t,offerModel:n}){super(),this.#q=e,this.#R=t,this.#j=n}get points(){return this.#U}get(){return this.#U}async init(){try{await Promise.all([this.#R.init(),this.#j.init()]);const e=await this.#q.getPoints();this.#U=e}catch(e){this.#U=[]}this._notify($.INIT)}async updatePoint(e,t){const n=this.#U.findIndex((e=>e.id===t.id));if(-1===n)throw new Error("Can't update unexisting task");try{t.base_price=Number(t.base_price);const i=await this.#q.updatePoint(t);console.log(i),this.#U=[...this.#U.slice(0,n),t,...this.#U.slice(n+1)],this._notify(e,t)}catch{}}async addPoint(e,t){try{t.base_price=Number(t.base_price);const n=await this.#q.addPoint(t);this.#U=[n,...this.#U.slice()],this._notify(e,t)}catch{}}async deletePoint(e,t){const n=this.#U.findIndex((e=>e.id===t.id));if(-1===n)throw new Error("Can't update unexisting task");try{const i=await this.#q.deletePoint(t.id);console.log(i),this.#U=[...this.#U.slice(0,n),...this.#U.slice(n+1)],this._notify(e,t)}catch{}}}({service:V,destinationModel:Z,offerModel:z});J.init(),(new class{tripInfoComponent=new g;tripMainContainer=document.querySelector(".trip-main");filterComponent=new w;filterContainer=document.querySelector(".trip-controls__filters");init(){m(this.tripInfoComponent,this.tripMainContainer,"afterbegin"),m(this.filterComponent,this.filterContainer,"beforeend")}}).init();const X=new class{#V=new Map;#Z=[];constructor(e,t,n){this.destinationModel=e,this.offerModel=t,this.pointModel=n,this.pointModel.addObserver(this.#z),new q({destinationModel:e,offerModel:t,onDataAdd:this.#J}).init()}tripSortComponent=new C({onSortTypeChange:e=>{this.#X(e)}});tripEventContainer=document.querySelector(".trip-events");listComponent=new E;init(){m(this.tripSortComponent,this.tripEventContainer,"afterbegin"),m(this.listComponent,this.tripEventContainer),this.#K()}#z=(e,t)=>{switch(console.log(e,t),e){case $.MINOR:console.log("data.id ",t.id),this.#W(),this.#K();break;case $.PATCH:console.log("data.id ",t.id),this.#V.get(t.id).init(t);break;case $.INIT:this.#K()}};#J=(e,t,n)=>{switch(console.log(e,t,n),e){case H:this.pointModel.updatePoint(t,n);break;case F:this.pointModel.addPoint(t,n);break;case I:this.pointModel.deletePoint(t,n)}};get points(){return this.pointModel.points}#K=()=>{this.points.forEach((e=>{const t=new O({list:this.listComponent,dest:this.destinationModel,offer:this.offerModel,setFavourite:this.#S,onDataChange:this.#J,onModeChange:this.#G});t.init(e),this.#V.set(e.id,t)}))};#G=()=>{this.#V.forEach((e=>{e.resetView()}))};#X(e){console.log("sortType ",e),this.#Q(e),this.#W(),this.#K()}#W=()=>{this.#V.forEach((e=>{e.destroy()}))};#Q=e=>{this.#Z=((e,t)=>{switch(e){case"sort-day":case k:throw new Error(`Sort by ${k} is not emplemented`);case x:throw new Error(`Sort by ${x} is not emplemented`);case"sort-price":return console.log("!!!ready   ",t.sort(((e,t)=>e.base_price-t.base_price))),[...t].sort(((e,t)=>e.base_price-t.base_price));case"sort-time":return t.sort()}})(e,this.#Z),console.log("WoW",this.#Z)};#S=e=>{console.log("favourite changed");const t=this.boardEvents.findIndex((t=>t.id===e.id));this.boardEvents[t].is_favorite=!this.boardEvents[t].is_favorite,this.#V.get(this.boardEvents[t].id).init(this.boardEvents[t])}}(Z,z,J);X.init()})()})();
//# sourceMappingURL=bundle.9b5f96eb7af4ab605001.js.map